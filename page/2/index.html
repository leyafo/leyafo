<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]><html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]><html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" prefix="og: http://ogp.me/ns#" xmlns:og="http://ogp.me/ns#"><!--<![endif]-->

    <head>
                <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="author" content="">
        <meta name="keywords" content="awesome, definitely">
	
        <meta property="og:site_name" content="Doing Right Things">
        <meta property="og:title" content="Doing Right Things">
        <meta property="og:url" content="http://www.leyafo.com/">
        <meta property="og:description" content="">
    
        <meta property="og:type" content="website" />
    
        <meta name="generator" content="Hugo 0.16" />
        
        <title>Doing Right Things</title>
        <meta property='og:title' content="Doing Right Things">
        <meta property="og:type" content="website">
        

        <link rel="canonical" href="http://www.leyafo.com/" />
        <link rel="alternate" type="application/rss+xml" title="RSS" href="http://www.leyafo.com/index.xml">
        <link rel="stylesheet" type='text/css' href="http://www.leyafo.com/css/main.css"/>
        <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300|Montserrat:700' rel='stylesheet' type='text/css'>
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
        <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
    </head>

<body>
<!--[if lt IE 7]><p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chrome/‎">install Google Chrome</a> to experience this site.</p><![endif]-->

    <header id="site-header">
        <div class="container">
            <a href="http://www.leyafo.com/" alt="Doing Right Things"><h1 class="blog-title heading">Doing Right Things</h1></a>
            <p class="blog-description"></p>
        </div>
    </header>

<main class="content" role="main">
	<div class="container">
	
		<article class="li post">
    <header class="post-header">
        <h3 class="post-title"><a href="http://www.leyafo.com/post/2014-01-06-rails-ajax/">Rails 的 AJAX</a></h3>
        <p class="post-time"><time datetime="2014-01-06T14:00:00&#43;08:00">January 6, 2014</time></p>
    </header>
    
    <section class="post-excerpt">
        <p>在 Rails 中只需要指定在 erb 模板中指定 remote=true 选项就可以将请求变为异步的了。request-handle-response-callback 这是一个 AJAX 请求的过程。rails 将这些步骤直接简化成了 request 和 handle 两步，让它看起来的像魔法一样而简洁神秘。在我初次接触 Rails 的 AJAX 时，我也随手去翻了下 wikipedia 关于 AJAX 的条目。AJAX 很好理解，但这并未让我更好的去完全理解 Rails 魔法般的 *AJAX*。主要被困惑的在 controller 的 handle 函数里面的 response 实现。 def handle @model = new some_model #do something if @model.save respond_to do |format| format.js end end 上面是一个典型的 Rails 应用场景，完全没有了那些简单粗暴原生的 html 与 javascript 的代码，更加别想看到 XMLHttpRequest 这种对象了。respond_to 是一个接收代码块的方法。而 format 表示 response 时使用的数据格式，format.js 会找到对应的 handle.js 并将里面的 js 代码 repond 到客户端。这仅仅只是客户端需要</p>
    </section>

    <footer class="post-footer">
        <span>
            
            <a href="http://www.leyafo.com/post/2014-01-06-rails-ajax/#comments"><i class="fa fa-comment"></i> Comments</a>
            
            
        </span>
    </footer>
</article>

	
		<article class="li post">
    <header class="post-header">
        <h3 class="post-title"><a href="http://www.leyafo.com/post/2013-11-26-the-best-practical-vim/">vim 最佳实践</a></h3>
        <p class="post-time"><time datetime="2013-11-26T04:01:00&#43;08:00">November 26, 2013</time></p>
    </header>
    
    <section class="post-excerpt">
        <p>#重装你的vim 是的,重新安装你的 vim. 因为默认安装的 vim 是不带 python 和 lua,ruby,perl 这一系列脚本支持的.因此你需要加入这些脚本支持,然后重新编译安装.重新安装前请先备份好 ~/.vim 目录中的东西与 vimrc. ##源码编译安装: 以 OSX 系统为例,在 vim 源码目录的 src 目录下有一个 configure 文件.运行 ./configure &ndash;help 可以看到一些编译选项,从中添加你想要的编译选项.在添加 &ndash;enable-pythoninterp 请一定要带上 &ndash;with-python-config-dir 这个选项,用来指向你的 python config 目录.在 OSX 系统中这个值一般是: /Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/config. 另外请勿使用 homebrew 安装的 python, 编译过程中会找不到 python frameworks. 如果配置有问题可以查看 src 目录中 auto/config.log 来看详细错误.编译成功后会在 src/macvim/build/release 目录生成好 dmg 安装包. ##从homebrew中安装: homebrew 也是下载好源码然后编译安装的.在 brew install macvim 前,可以使用 brew edit macvim 来编辑一些编译选项.只需要在 args = %w[] 这个中括号里面添加 configure 中的编译选项. 编译中产生的错误日志可以在 ~/Library/Logs/Homebrew/macvim 目录下查看.</p>
    </section>

    <footer class="post-footer">
        <span>
            
            <a href="http://www.leyafo.com/post/2013-11-26-the-best-practical-vim/#comments"><i class="fa fa-comment"></i> Comments</a>
            
            
        </span>
    </footer>
</article>

	
		<article class="li post">
    <header class="post-header">
        <h3 class="post-title"><a href="http://www.leyafo.com/post/2013-11-23-tail-recursion-optimization/">尾递归优化</a></h3>
        <p class="post-time"><time datetime="2013-11-23T11:47:00&#43;08:00">November 23, 2013</time></p>
    </header>
    
    <section class="post-excerpt">
        <p>递归是一个奇特的玩意,能简洁的描述复杂的思考. 一个简单的递归函数: def fibonacci(n): if n &lt;= 1: return 1 return fibonacci(n-1) + fibonacci(n-2) 这个函数实现了一个裴波那契数列.非常简单,代码只有 3 行,但如果跟着函数运行的轨迹走.会发现这个函数背后的调用过程非常的复杂.每次递归都会依赖前面两次计算的结果.随着递归的层级上升,每次都会重新去调用前两次计算产生的结果.为了简化描述,下面是以 fibonacci(5) 模拟递归调用过程. 可以看到,每次递归都会重复前两次的调用过程.实际上这个递归数列并不需要每次都重复去求前两次的结果.如果用压栈的方法,一遍递归就可以搞定了. def fibonacci(n): L = fibonacci.L if n &lt;= 2: return L[-1] #get top else: n2 = L.pop() n1 = L.pop() L.append(n2) #'append' is stack's push L.append(n1+n2) return fibonacci(n-1) fibonacci.L = [1,1] 上面的代码耍了一个小花招.首先先设定好两个初始的计算结果,然后开始递归迭代.与前一版本递归不同的是,前一个递归需要在进入到递归底部后,才开始跳出来计算每一步递归后的结果,直到返回.而后一个递归会在最开始递归进入时就开始计算,进入到递归底部后(也就是 n &lt;= 2)最终的结果就已经计算出来了,直接一层一层返回这个结果就可以了. 为了便于说明下面代码是利用两个变量做中间结果的版本: def fib(n, n1=1, n2=1): if n &lt; 2: return n1 return fib(n-1, n2, n1+n2) 跟上面那个压栈的方式一样.先设定好两个默认的结果,在递归进入时直接将结果计算出来并保存好.</p>
    </section>

    <footer class="post-footer">
        <span>
            
            <a href="http://www.leyafo.com/post/2013-11-23-tail-recursion-optimization/#comments"><i class="fa fa-comment"></i> Comments</a>
            
            
        </span>
    </footer>
</article>

	
		<article class="li post">
    <header class="post-header">
        <h3 class="post-title"><a href="http://www.leyafo.com/post/2013-11-14-on-nosql/">关于NoSQL</a></h3>
        <p class="post-time"><time datetime="2013-11-14T09:39:00&#43;08:00">November 14, 2013</time></p>
    </header>
    
    <section class="post-excerpt">
        <p>传统关系型数据库,将数据以表结构的方式存储起来.并且所有的数据是基于 ACID1 原则.这种方式存储数据有很明显的缺点.首先,为了保证一致性,基于 ACID2 类型的数据库都是使用事物来保持数据的一致性.也就是说同时只能有一个 client 提交数据.然后,以表结构存储的数据库架构是死的,一个表的列基本上是固定的.如果变化的话会带来很多问题. 比如: 1.我有一种数据,这些数据都是一些 Excle 表格.每个表格的列都不相同.但实际上他们都是一种数据.该如何存储? 2.一个表有 10 列,我想再加一个字段,但这个字段并不是所有数据都需要的. 3.问题同上,如果加 20 个字段呢?再新建一个表?新建的表如何与现有的表关联? 最后关联性数据库还有个不利于分布的弱点,如果数据分布在 N 台分布式的机器上,数据库该如何管理? 为了弥补这些缺点, NoSQL 类数据库诞生了.首先 NoSQL 类数据库有以下特点: schema-less: 数据没有字段的概念,并且数据仓库(关联型数据库的 table )可以随时变化字段. Strong Consistency: 保证数据最终的一致性. High Availability: 保证所有请求数据的客户端都能得到一份数据的 copy. Partition-tolerance: 数据可以不限于分布在同一台机器上. 一般 NoSQL 类数据库存储数据的模型有 4 种方式: Key-Value: 类似于 json 的 key-value 的方式进行数据存储 BigTable: 多维度的 key-value 结构,并且存储方式是分布式,稀疏的3,严格排序的. *Google*很多产品都在用,具有高压缩,高性能,易于查询的特点. Documents: 多个 key-value 结构的数据合为一条数据,每一条数据称为为一个 docment. 并且每个 docment 的 key-value 个数和 key 都可以不同.并且在搜索时,可以以 value 做为关键字来搜索. Graph: 以网状方式将数据存储在一个 dataset 中.适合存储有关联的数据.</p>
    </section>

    <footer class="post-footer">
        <span>
            
            <a href="http://www.leyafo.com/post/2013-11-14-on-nosql/#comments"><i class="fa fa-comment"></i> Comments</a>
            
            
        </span>
    </footer>
</article>

	
		<article class="li post">
    <header class="post-header">
        <h3 class="post-title"><a href="http://www.leyafo.com/post/2013-11-08-python-memory-management/">Python内存管理</a></h3>
        <p class="post-time"><time datetime="2013-11-08T11:25:00&#43;08:00">November 8, 2013</time></p>
    </header>
    
    <section class="post-excerpt">
        <p>本文基于Python2.7.5源码中的obmalloc.c模块 在 Python 的内部系统中，它的内存管理结构是以金子塔结构呈现的.如下图所示: - 其中-1和-2这两层是跟操作系统来负责的,这里我们略过不表. - 第0层就是我们平常在 C 中使用的 malloc, Python 不会直接使用它,而是会在此基础上做一个内存池. - 第1层是 Python 自己在基于 malloc 的基础上构造的一个内存池. - 第2和第3层是基于第1层的.每当 Python 内部需要使用内存时,会使用第1层做好的分配器来分配内存. 因此第1层是 Python 内部管理内存的主要地方. 作用 在 C 中如果频繁的调用 malloc 与 free 时,是会产生性能问题的.再加上频繁的分配与释放小块的内存会产生内存碎片. Python 在这里主要干的工作有: 1. 如果请求分配的内存在1~256字节之间就使用自己的内存管理系统,否则直接使用 malloc. 2. 这里还是会调用 malloc 分配内存,但每次会分配一块大小为256k的大块内存. 3. 经由内存池登记的内存到最后还是会回收到内存池,并不会调用 C 的 free 释放掉.以便下次使用. 内存池结构 如上图所示,整个黑框格子代表内存池(usedpools).每个单元格存放一个双向链表,每个链表的节点是一个大小为4k的内存块.在这个池中,每个单元格负责管理不同的小块内存.为了便于管理,每个单元格管理的内存块总是以8的倍数为单位.以如下代码为例: PyObject_Malloc(3) 这里我们需要一块大小为3个字节的内存.它将定位到管理大小为8字节的单元格.然后返回大小8字节的内存.在这里 usedpools 有一个令人蛋疼的 ticky. usedpools 在初始化时用了如下代码: #define PTA(x) ((poolp )((uchar *)&amp;(usedpools[2*(x)]) - 2*sizeof(block *))) #define PT(x) PTA(x), PTA(x) static poolp usedpools[2 * ((NB_SMALL_SIZE_CLASSES + 7) / 8) * 8] = { PT(0), PT(1), PT(2), PT(3), PT(4), PT(5), PT(6), PT(7) ......</p>
    </section>

    <footer class="post-footer">
        <span>
            
            <a href="http://www.leyafo.com/post/2013-11-08-python-memory-management/#comments"><i class="fa fa-comment"></i> Comments</a>
            
            
        </span>
    </footer>
</article>

	
		<article class="li post">
    <header class="post-header">
        <h3 class="post-title"><a href="http://www.leyafo.com/post/2016-07-25-rent-room-story/"></a></h3>
        <p class="post-time"><time datetime="0001-01-01T00:00:00Z">January 1, 0001</time></p>
    </header>
    
    <section class="post-excerpt">
        <p>Untitled /* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */ /* Remove comment around @import statement below when using as a custom stylesheet */ /*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/ article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block} audio,canvas,video{display:inline-block} audio:not([controls]){display:none;height:0} [hidden],template{display:none} script{display:none!important} html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%} body{margin:0} a{background:transparent} a:focus{outline:thin dotted} a:active,a:hover{outline:0} h1{font-size:2em;margin:.67em 0} abbr[title]{border-bottom:1px dotted} b,strong{font-weight:bold} dfn{font-style:italic} hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0} mark{background:#ff0;color:#000} code,kbd,pre,samp{font-family:monospace;font-size:1em} pre{white-space:pre-wrap} q{quotes:"\201C" "\201D" "\2018" "\2019"} small{font-size:80%} sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline} sup{top:-.5em} sub{bottom:-.25em} img{border:0} svg:not(:root){overflow:hidden} figure{margin:0} fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em} legend{border:0;padding:0} button,input,select,textarea{font-family:inherit;font-size:100%;margin:0} button,input{line-height:normal} button,select{text-transform:none} button,html</p>
    </section>

    <footer class="post-footer">
        <span>
            
            <a href="http://www.leyafo.com/post/2016-07-25-rent-room-story/#comments"><i class="fa fa-comment"></i> Comments</a>
            
            
        </span>
    </footer>
</article>

	
	
<nav role="pagination" class="pagination">
  
  <a href="/" class="newer-posts">
    <i class="fa fa-angle-double-left"></i>&nbsp;Newer&nbsp;
  </a>
  
	<span class="post-list-pagination-item post-list-pagination-item-current">Page 2 of 2</span>

</nav>

	</div>
</main>
    <footer id="site-footer">
        <div class="container">
            <a href="http://www.leyafo.com/index.xml" title="Get the RSS feed"><span class="tooltip"><i class="fa fa-rss"></i></span></a>
            <section>&copy; <a href="http://www.leyafo.com/"></a> 2015 | All rights reserved</section>
            <section>Theme by <a href="http://www.jrdnbwmn.com">Jordan Bowman</a>. Generated with <a href="http://gohugo.io/">Hugo</a>.</section>
        </div>
    </footer>

    <script type="text/javascript" src="http://www.leyafo.com/js/fittext.js"></script>
    <script type="text/javascript">
      $(".heading").fitText();
    </script>

</body>
</html>
